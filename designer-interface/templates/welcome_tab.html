<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Telemetry Exploration</title>
    <link rel="stylesheet" href="static/styles.css">
    <style>
        #main-content {
            display: none;
        }
        
        .form-buttons {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .center-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
        }

        .checkbox-container {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 5px;
            margin-bottom: 10px;
        }

        .file-upload label {
            margin-bottom: 15px;
            display: block;
        }

        .file-upload input {
            margin-bottom: 25px;
        }

        .sensor-inputs label {
            margin-bottom: 15px;
            display: block;
        }

        .sensor-inputs input {
            margin-bottom: 25px;
        }

        .continue-button {
            margin-top: 10px;
        }
    </style>
</head>

<body>
    <!-- Navigation Bar -->
    <header>
        <nav class="navbar">
            <div class="logo">
                <a href="#">Interactive Telemetry Exploration</a>
            </div>
            <ul class="nav-links">
                <li><a href="{{ url_for('upload_page') }}">Home</a></li>
            </ul>
        </nav>
    </header>

    <div class="content">
        <h1>Welcome to Interactive Telemetry Exploration</h1>
        <p>For designers supported by video stream and active learning</p>
    <div>

    <div id="flash-messages">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flash-message flash-{{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>
    
    <div>
        <form method="GET" action="{{ url_for('predict_continue') }}">
            <button id="used-mode-btn" class="start-button" type="submit">Use Trained Model</button>
        </form>
    </div>
    <br>
    <div>
        <button id="create-new-btn" class="start-button" onclick="goToDataUpload()">Create New Model</button>
    </div>

    <!-- Main content div that will be initially hidden -->
    <div id="main-content">
        <form method="POST" action="{{ url_for('handle_upload') }}" enctype="multipart/form-data" id="upload-form">
            <!-- MP4 File Upload -->
            <div class="file-upload">
                <label for="mp4-upload">Upload GoPro Video:</label>
                <input type="file" id="mp4-upload" name="mp4-upload" accept=".mp4" onchange="checkContinue()">
            </div>

            <!-- Checkbox to Show/Hide CSV File Upload -->
            <div class="center-container">
                <div class="checkbox-container">
                    <input type="checkbox" id="toggle-CSV-upload" onchange="toggleCSVUpload()">
                    <label for="toggle-CSV-upload">Upload IMU and Video Separately</label>
                </div>
            </div>

            <!-- CSV File Upload -->
            <div id="CSV-upload-container" class="sensor-inputs" style="display: none;">
                <label for="CSV-upload">Upload IMU data:</label>
                <input type="file" id="CSV-upload" name="CSV-upload" accept=".csv" onchange="checkContinue()">
            </div>

            <!-- Advanced Settings -->
            <div class="center-container">
                <button type="button" id="advanced-settings-btn" class="small-button" onclick="showPopup()">Advanced Settings</button>
                <div id="settings-fields" style="display: none;">
                    <label for="a1">Field A1:</label>
                    <input type="number" id="a1" name="a1" value="3"><br>
                    <label for="a2">Field A2:</label>
                    <input type="number" id="a2" name="a2" value="3"><br>
                    <label for="a3">Field A3:</label>
                    <input type="number" id="a3" name="a3" value="3"><br>
                    <label for="a4">Field A4:</label>
                    <input type="number" id="a4" name="a4" value="3"><br>
                    <label for="a5">Field A5:</label>
                    <input type="number" id="a5" name="a5" value="3"><br><br>
                    <button type="button" class="small-button" onclick="retractSettings()">Retract Settings</button>
                </div>
            </div>

            <!-- Popup -->
            <div id="popup" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border: 1px solid black; padding: 20px; z-index: 1000;">
                <p>WARNING: These settings have been tuned using validation datasets, changing the settings might result in a less effective model.</p>
                <button type="button" onclick="confirmPopup()">Acknowledge</button>
            </div>

            <!-- Overlay to dim the background -->
            <div id="overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 999;"></div>

            <!-- Continue Button -->
            <div class="continue-button">
                <button type="submit" id="continue-btn" class="small-button" style="background-color: grey" disabled>Continue</button>
            </div>
        </form>
    </div>

    <script>
        // Function to go to data upload page
        function goToDataUpload() {
            document.getElementById('main-content').style.display = 'block';
            document.getElementById('used-mode-btn').style.display = 'none';
            document.getElementById('create-new-btn').style.display = 'none';
        }

        function toggleCSVUpload() {
            const CSVUploadContainer = document.getElementById('CSV-upload-container');
            CSVUploadContainer.style.display = CSVUploadContainer.style.display === 'none' ? 'block' : 'none';
            checkContinue();
        }

        function checkContinue() {
            const mp4Upload = document.getElementById('mp4-upload').files.length > 0;
            const csvRequired = document.getElementById('toggle-CSV-upload').checked;
            const csvUpload = document.getElementById('CSV-upload').files.length > 0;
            const continueBtn = document.getElementById('continue-btn');

            if (mp4Upload && (!csvRequired || (csvRequired && csvUpload))) {
                continueBtn.style.backgroundColor = 'green';
                continueBtn.style.cursor = 'pointer';
                continueBtn.disabled = false;
            } else {
                continueBtn.style.backgroundColor = 'grey';
                continueBtn.style.cursor = 'not-allowed';
                continueBtn.disabled = true;
            }
        }

        function showPopup() {
            document.getElementById('popup').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
        }

        function confirmPopup() {
            document.getElementById('popup').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('advanced-settings-btn').style.display = 'none';
            document.getElementById('settings-fields').style.display = 'block';
        }

        function retractSettings() {
            document.getElementById('settings-fields').style.display = 'none';
            document.getElementById('advanced-settings-btn').style.display = 'block';
        }
    </script>
</body>
</html>